---
output:
  html_document: default
  pdf_document: default
---


# INSTRUCTIONS

-   This is a group assignment.
-   Submit your answer digitally as two files through Moodle:
    -   An R markdown file (extension **Rmd**). Use the template provided
        to you and provide your answers (both code and text) below each
        question.
    -   An **HTML** file &ldquo;knitted&rdquo; by RStudio including all the results and
        plots. More details on how to create these files were provided
        in class on week 3.
-   Follow the Style Guide (available on Moodle). You can be
    penalized on up to 20% in each question for which you do not follow
    the Style Guide.
-   Questions regarding the assignment should be posted <span class="underline">exclusively</span> on
    the respective discussion forum on Moodle.


## <span class="underline">Deadline:</span> Monday, March 10 at 23:59.

-   Late submissions are <span class="underline">not allowed</span>

<span class="underline">**Warning:**</span> The detection of <span class="underline">any form of plagiarism</span> in your work
means the assignment will be graded with <span class="underline">ZERO points</span>.

\newpage


# Dating Platforms

Online dating platforms enable people to find new connections with the
goal of developing personal, romantic, or sexual relationships. In
some platforms individuals express their interest in others in
multiple ways, including by &ldquo;liking&rdquo; them. &ldquo;Liking&rdquo; someone is an
indication of interest that, in most platforms, is revealed to both
individuals only if the &ldquo;liking&rdquo; is mutual, i.e., if the target
individual also stated interest. In such cases we say there is a
match.

For this assignment we are going to analyze &ldquo;likes&rdquo; issued by members
in an online dating platform using tools learned in class. Answer each
of the questions below the best you can. In case you find any
ambiguity in the question, assume the most sensible option in you
opinion, state your assumptions and proceed. In most cases ambiguity
is by design.


## Data Description

The file `nda-dating-likes.RData` contains two `data.table`, each of
them is described below.


### `dt.users`

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Field</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td class="org-left"><code>user_id</code></td>
<td class="org-left">integer</td>
<td class="org-left">user identification</td>
</tr>


<tr>
<td class="org-left"><code>inviter_id</code></td>
<td class="org-left">integer</td>
<td class="org-left">id of the user that invited this user to the platform</td>
</tr>


<tr>
<td class="org-left"><code>gender</code></td>
<td class="org-left">string</td>
<td class="org-left">gender</td>
</tr>


<tr>
<td class="org-left"><code>birth_year</code></td>
<td class="org-left">integer</td>
<td class="org-left">year of birth</td>
</tr>


<tr>
<td class="org-left"><code>education</code></td>
<td class="org-left">integer</td>
<td class="org-left">education</td>
</tr>


<tr>
<td class="org-left"><code>approved_week</code></td>
<td class="org-left">date</td>
<td class="org-left">week in which this user was approved to the platform</td>
</tr>


<tr>
<td class="org-left"><code>height</code></td>
<td class="org-left">integer</td>
<td class="org-left">height (in cm)</td>
</tr>


<tr>
<td class="org-left"><code>children</code></td>
<td class="org-left">boolean</td>
<td class="org-left">whether the user has children</td>
</tr>


<tr>
<td class="org-left"><code>smoker</code></td>
<td class="org-left">boolean</td>
<td class="org-left">whether the user smokes</td>
</tr>


<tr>
<td class="org-left"><code>n_fb_friends</code></td>
<td class="org-left">integer</td>
<td class="org-left">how many Facebook friends does the user have</td>
</tr>
</tbody>
</table>


### `dt.likes`

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Field</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td class="org-left"><code>sender_user_id</code></td>
<td class="org-left">integer</td>
<td class="org-left">user identification of the sender of the like</td>
</tr>


<tr>
<td class="org-left"><code>receiver_user_id</code></td>
<td class="org-left">integer</td>
<td class="org-left">user identification of the receiver of the like</td>
</tr>


<tr>
<td class="org-left"><code>week</code></td>
<td class="org-left">date</td>
<td class="org-left">week in which the like was issued</td>
</tr>
</tbody>
</table>

\newpage 


## Setup and data loading

Start by loading the required libraries and loading the likes data

```{r   }
library(data.table)
library(ggplot2)
library(igraph)

load("nda-dating-likes.RData") 
```


## Questions


### Invites Network `[10 points]`

This section contains questions related to the invites network.

1.  *(Easy)* Build a directed graph representing the invites network: an
    individual A is connected to individual B if A invited B to the
    platform. What is the size of the longest chain? What is the
    clustering coefficient of this network? Justify. `[3 points]`
    
```{r}
# <answer here>
```

2.  *(Easy, once you get what you need to do)* Goel, Watts and Goldstein,
    in their paper entitled &ldquo;The structure of online diffusion
    networks&rdquo;, state that long cascades in diffusion networks happen
    very rarely in online networks. Do you think is also the case with
    the invites network in this online dating platform? Perform the
    analyses you deem necessary to answer this question with reasonable
    confidence. `[3 points]`
    
```{r}
# <answer here>
```
  
3.  *(Moderate)* Do you think the invites network exhibits homophily?
    In other words, do you think men are more likely to invite other
    men and women more likely to invite other women? What about in
    terms of age? Do members tend to invite members of a similar age?
    Please describe your overall approach to answering these questions
    and justify and explain each step of your answer. `[1 point]`
    
```{r}
# <answer here>
```
    
4.  *(Make up question: You can skip any of the previous questions and
    answer this question instead.)* Describe and perform any additional
    analysis you want **using the invites network**. You will be graded
    by the creativity and correctness of the analysis, but also as a
    comparison to the best answers provided by other students. The best
    answers will have full points, while the other answers will be
    judged by comparison with the best answers. `[3 points]`
    
```{r}
# <answer here>
```
    
### Likes Network `[10 points]`

This section contains questions related to the likes network.

1.  *(Easy)* Build a directed graph representing the likes network: an
    individual A is connected to individual B if A liked B. What is the
    clustering coefficient of this network? Justify. `[2.5 points]`

```{r}
# Create a directed graph representing the likes network
dt.likes.g <- dt.likes[, list(sender_user_id, receiver_user_id)]
g.likes.directed <- graph_from_data_frame(d = dt.likes.g, directed = TRUE)

# Plot a sample (original graph is too big to plot)
sample.nodes <- sample(V(g.likes.directed), 500)
g.sample <- induced.subgraph(g.likes.directed, vids = sample.nodes)
plot(g.sample, vertex.label = NA, vertex.size = 10, edge.arrow.size = 0.5)

# Compute the clustering coefficient
average.cluster.directed <- transitivity(g_likes, type="average")
print("Clustering Coefficient:")
print(average.cluster.directed)

# A: Clustering coefficient is 0.0004102289
```

2.  *(Moderate)* How many individuals &ldquo;like&rdquo; individuals of the same
    gender? Does this happen more between women or between men? `[2.5
       points]`

```{r}
# Check if dt.users has duplicated user_id or missing gender
print("Number of rows with duplicated user_id in dt.users:")
print(sum(duplicated(dt.users$user_id)))
print("Number of rows with missing gender in dt.users:")
print(sum(is.na(dt.users$gender)))

# Merge likes data table and gender data
dt.likes.merged <- merge(dt.likes, dt.users[, list(user_id, sender_gender = gender)],
                         by.x = "sender_user_id", by.y = "user_id")
dt.likes.merged <- merge(dt.likes.merged, dt.users[, list(user_id, receiver_gender = gender)],
                         by.x = "receiver_user_id", by.y = "user_id", all.x = TRUE)

# Subset for same gender likes
dt.gender.same <- dt.likes.merged[sender_gender == receiver_gender, ]
dt.gender.same <- dt.gender.same[!(sender_user_id == receiver_user_id), ]

# Remove duplicate senders and users that like themselves
dt.gender.same.clean <- unique(dt.gender.same[!(sender_user_id == receiver_user_id), ],
                               by = "sender_user_id")

# Compute the number of individuals that like the same gender
t.gender.count.same <- table(dt.gender.same$sender_gender)
print("Number of individuals that like the same gender:")
print(t.gender.count.same)

# Check if all the users in dt.users are in dt.likes
print("Number of users in dt.users not in dt.likes:")
number.users <- dt.users[!((dt.users$user_id %in% dt.likes$receiver_user_id) | 
                             (dt.users$user_id %in% dt.likes$sender_user_id)), .N]
print(number.users)

# Compute the the number of individuals in proportion to total users
print("Proportion of individuals that like the same gender by gender:")
t.gender.count.all <- table(dt.users$gender)
t.gender.proportion.same <- t.gender.count.same / t.gender.count.all
print(t.gender.proportion.same)

# A: Male - 326 (4.83%); Female - 206 (2.48%)
```

3.  *(Easy)* Build an undirected graph representing the matches
    network: an individual A is connected to individual B if A liked B
    and B liked A. What is the clustering coefficient of this network?
    Justify. Hint: the function `as.undirected` transforms a directed
    graph into an undirected graph; it can transform only the mutually
    directed edges in undirected edges. `[2.5 points]`

```{r}
# Transform the directed graph built in question 1 into an undirected graph
g.likes.undirected <- as.undirected(g.likes.directed, mode = "mutual")

# Plot a sample (original graph is too big to plot)
sample.nodes <- sample(V(g.likes.undirected), 500)
g.sample <- induced.subgraph(g.likes.undirected, vids = sample.nodes)
plot(g.sample, vertex.label = NA, vertex.size = 10, edge.arrow.size = 0.5)

# Compute the clustering coefficient
average.cluster.undirected <- transitivity(g_likes, type="average")
print("Clustering Coefficient:")
print(average.cluster.undirected)

# A: Clustering coefficient is 0.0004102289
```

4.  *(Moderate)* A recent research article gathered significant
    attention for claiming that, contrary to decades of prior research,
    most real life networks are not scale-free (i.e., the degree
    distribution does no not follow a power law). Based on the Quanta
    Magazine article (not on the original research paper) linked below,
    how do you classify the network of matches? Does it resemble a
    random network, a free-scale network, or a mixed network? Justify
    your answer. `[2.5 points]`
    
    Article: <http://bit.ly/2BwobR1>

```{r}
# <answer here>
```

5.  *(Make-up question: You can skip any of the previous questions
    and answer this question instead.)* Describe and perform any
    additional analysis you want **using the any network originated from
    the likes data.** You will be graded by the creativity and
    correctness of the analysis, but also as a comparison to the best
    answers provided by other students. The best answers will have full
    points, while the other answers will be judged by comparison with
    the best answers. `[2.5 points]`
    
```{r}
# <answer here>
```
    
